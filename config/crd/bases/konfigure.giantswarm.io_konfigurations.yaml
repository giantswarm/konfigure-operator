---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.16.4
  name: konfigurations.konfigure.giantswarm.io
spec:
  group: konfigure.giantswarm.io
  names:
    kind: Konfiguration
    listKind: KonfigurationList
    plural: konfigurations
    shortNames:
    - kfg
    singular: konfiguration
  scope: Namespaced
  versions:
  - additionalPrinterColumns:
    - jsonPath: .spec.destination.namespace
      name: Destination
      type: string
    - jsonPath: .spec.destination.naming.prefix
      name: Prefix
      type: string
    - jsonPath: .spec.destination.naming.suffix
      name: Suffix
      type: string
    - jsonPath: .spec.destination.naming.useSeparator
      name: UseSeparator
      type: boolean
    - jsonPath: .spec.targets.schema.reference.name
      name: SchemaName
      type: string
    - jsonPath: .spec.targets.schema.reference.namespace
      name: SchemaNamespace
      type: string
    - jsonPath: .metadata.creationTimestamp
      name: Age
      type: date
    - jsonPath: .spec.reconciliation.suspend
      name: Suspended
      type: boolean
    - jsonPath: .status.conditions[?(@.type=="Ready")].status
      name: Ready
      type: string
    - jsonPath: .status.conditions[?(@.type=="Ready")].message
      name: Status
      type: string
    name: v1alpha1
    schema:
      openAPIV3Schema:
        description: Konfiguration is the Schema for the konfigurations API.
        properties:
          apiVersion:
            description: |-
              APIVersion defines the versioned schema of this representation of an object.
              Servers should convert recognized schemas to the latest internal value, and
              may reject unrecognized values.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources
            type: string
          kind:
            description: |-
              Kind is a string value representing the REST resource this object represents.
              Servers may infer this from the endpoint the client submits requests to.
              Cannot be updated.
              In CamelCase.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
            type: string
          metadata:
            type: object
          spec:
            description: KonfigurationSpec defines the desired state of the Konfiguration.
            properties:
              destination:
                description: Defines where and how to store the rendered konfigurations.
                properties:
                  namespace:
                    description: Defines the namespace where the rendered Kubernetes
                      manifests will be applied.
                    type: string
                  naming:
                    description: Defines rules on how to name the rendered Kubernetes
                      manifests.
                    properties:
                      prefix:
                        description: Prefix is prepended at the beginning of the iteration
                          name.
                        pattern: ^[a-z0-9]([-a-z0-9]{0,62}[a-z0-9])?$
                        type: string
                      suffix:
                        description: Suffix is appended to the end of the iteration
                          name.
                        pattern: ^[a-z0-9]([-a-z0-9]{0,62}[a-z0-9])?$
                        type: string
                      useSeparator:
                        default: true
                        description: |-
                          UseSeparator indicates whether to separate the iteration name
                          from the prefix and/or suffix with a single `-` character.
                        type: boolean
                    type: object
                required:
                - namespace
                - naming
                type: object
              reconciliation:
                description: Defines how to reconcile the Konfiguration.
                properties:
                  interval:
                    description: The interval at which to reconcile the Konfiguration.
                    pattern: ^([0-9]+(\.[0-9]+)?(ms|s|m|h))+$
                    type: string
                  retryInterval:
                    description: The interval at which to retry a previously failed
                      reconciliation.
                    pattern: ^([0-9]+(\.[0-9]+)?(ms|s|m|h))+$
                    type: string
                  suspend:
                    default: false
                    description: |-
                      This flag tells the controller to suspend rendering the Konfiguration.
                      It does not apply to already started executions. Default is false.
                    type: boolean
                required:
                - interval
                type: object
              sources:
                description: Defines where to find the source of the konfiguration
                  that needs to be rendered.
                properties:
                  flux:
                    description: Defines to locate the source of the konfiguration
                      structure as a Flux source.
                    properties:
                      gitRepository:
                        description: Defines the source as a Flux GitRepository manifest.
                        properties:
                          name:
                            description: Name of the referenced Flux GitRepository
                              resource.
                            type: string
                          namespace:
                            description: Namespace of the referenced Flux GitRepository
                              resource.
                            type: string
                        required:
                        - name
                        - namespace
                        type: object
                    required:
                    - gitRepository
                    type: object
                type: object
              targets:
                description: Define what konfigurations to render.
                properties:
                  defaults:
                    description: |-
                      Define default inputs to be used for every single iteration.
                      Individual iterations may override default inputs.
                    properties:
                      variables:
                        description: Defines default variable inputs to be used for
                          every single iteration.
                        items:
                          description: NameValuePair is a simple structure for defining
                            input fields by name and value.
                          properties:
                            name:
                              description: Name of the input.
                              type: string
                            value:
                              description: Value of the input.
                              type: string
                          required:
                          - name
                          - value
                          type: object
                        type: array
                    type: object
                  iterations:
                    additionalProperties:
                      description: Iteration defines information needed to a single
                        konfiguration to render.
                      properties:
                        variables:
                          description: |-
                            Defines variable inputs specific for the given iteration.
                            These variables are merged on top of the default variables, and thus may choose to override default ones.
                          items:
                            description: NameValuePair is a simple structure for defining
                              input fields by name and value.
                            properties:
                              name:
                                description: Name of the input.
                                type: string
                              value:
                                description: Value of the input.
                                type: string
                            required:
                            - name
                            - value
                            type: object
                          type: array
                      type: object
                    description: |-
                      Defines what konfigurations to render. A single reconciliation loop iterates over each entry
                      and renders the konfiguration, wraps them to Kubernetes manifests and enforces the state of those in the cluster.
                    type: object
                  schema:
                    description: Defines where to locate the KonfigurationSchema.
                    properties:
                      reference:
                        description: Defines where to locate the KonfigurationSchema
                          as a Kubernetes manifest.
                        properties:
                          name:
                            description: Defines the .metadata.name of the KonfigurationSchema
                              Kubernetes manifest to fetch.
                            type: string
                          namespace:
                            description: Defines the .metadata.namespace of the KonfigurationSchema
                              Kubernetes manifest to fetch.
                            type: string
                        required:
                        - name
                        - namespace
                        type: object
                    required:
                    - reference
                    type: object
                required:
                - defaults
                - schema
                type: object
            required:
            - destination
            - sources
            - targets
            type: object
          status:
            description: KonfigurationStatus defines the observed state of Konfiguration.
            properties:
              conditions:
                items:
                  description: Condition contains details for one aspect of the current
                    state of this API Resource.
                  properties:
                    lastTransitionTime:
                      description: |-
                        lastTransitionTime is the last time the condition transitioned from one status to another.
                        This should be when the underlying condition changed.  If that is not known, then using the time when the API field changed is acceptable.
                      format: date-time
                      type: string
                    message:
                      description: |-
                        message is a human readable message indicating details about the transition.
                        This may be an empty string.
                      maxLength: 32768
                      type: string
                    observedGeneration:
                      description: |-
                        observedGeneration represents the .metadata.generation that the condition was set based upon.
                        For instance, if .metadata.generation is currently 12, but the .status.conditions[x].observedGeneration is 9, the condition is out of date
                        with respect to the current state of the instance.
                      format: int64
                      minimum: 0
                      type: integer
                    reason:
                      description: |-
                        reason contains a programmatic identifier indicating the reason for the condition's last transition.
                        Producers of specific condition types may define expected values and meanings for this field,
                        and whether the values are considered a guaranteed API.
                        The value should be a CamelCase string.
                        This field may not be empty.
                      maxLength: 1024
                      minLength: 1
                      pattern: ^[A-Za-z]([A-Za-z0-9_,:]*[A-Za-z0-9_])?$
                      type: string
                    status:
                      description: status of the condition, one of True, False, Unknown.
                      enum:
                      - "True"
                      - "False"
                      - Unknown
                      type: string
                    type:
                      description: type of condition in CamelCase or in foo.example.com/CamelCase.
                      maxLength: 316
                      pattern: ^([a-z0-9]([-a-z0-9]*[a-z0-9])?(\.[a-z0-9]([-a-z0-9]*[a-z0-9])?)*/)?(([A-Za-z0-9][-A-Za-z0-9_.]*)?[A-Za-z0-9])$
                      type: string
                  required:
                  - lastTransitionTime
                  - message
                  - reason
                  - status
                  - type
                  type: object
                type: array
              disabled:
                description: |-
                  The list of rendered manifests that were not applied during the last full reconciliation,
                  because their reconciliation is disabled via the `configuration.giantswarm.io/reconcile: disabled` label.
                items:
                  description: |-
                    DisabledIteration defines information on managed Kubernetes manifests whose state is not currently enforced
                    because they are disabled for reconciliation.
                  properties:
                    appName:
                      description: The name of the iteration, that is the map key
                        under .spec.targets.iterations.
                      type: string
                    kind:
                      description: The kind of the iteration from the schema, generally
                        ConfigMap or Secret.
                      type: string
                    target:
                      description: Reference to the target manifest.
                      properties:
                        name:
                          description: Name of the resource.
                          type: string
                        namespace:
                          description: Namespace of the resource.
                          type: string
                      required:
                      - name
                      - namespace
                      type: object
                  required:
                  - appName
                  - kind
                  - target
                  type: object
                type: array
              failed:
                description: The list of failed iterations during the last full reconciliation.
                items:
                  description: FailedIteration defines information of a single failed
                    iteration.
                  properties:
                    appName:
                      description: The name of the iteration, that is the map key
                        under .spec.targets.iterations.
                      type: string
                    message:
                      description: Informational message on the cause of the failure.
                      type: string
                  required:
                  - appName
                  - message
                  type: object
                type: array
              lastAppliedRevision:
                description: |-
                  The last successfully applied revision.
                  Equals the Revision of the applied artifact from the referenced source.
                type: string
              lastAttemptedRevision:
                description: |-
                  The last revision that was attempted for reconciliation.
                  Equals the Revision of the last attempted artifact from the referenced source.
                type: string
              lastReconciledAt:
                description: The last time the Konfiguration attempted reconciliation.
                type: string
              observedGeneration:
                description: ObservedGeneration is the last observed generation.
                format: int64
                type: integer
            type: object
        type: object
    served: true
    storage: true
    subresources:
      status: {}
